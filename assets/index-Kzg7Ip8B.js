import{j as t,r as s,c as J}from"./react-vendor-BzzwJzSH.js";import{s as w}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const V=({children:e,isDaytime:n})=>t.jsx("div",{className:`app-container ${n?"day-theme":"night-theme"}`,children:e}),X=({videoRef:e,facingMode:n})=>t.jsx("video",{ref:e,className:`camera-preview${n==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),Y=({toggleCamera:e,capturePhoto:n,closeCamera:a})=>t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:e,"aria-label":"Alternar câmera",children:"🔄"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:n,"aria-label":"Capturar foto",children:"⭕"}),t.jsx("button",{className:"camera-btn",onClick:a,"aria-label":"Fechar câmera",children:"✖"})]}),Z=({photo:e,closePreview:n})=>t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:e,alt:"Foto capturada"}),t.jsx("a",{href:e,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"⬇️ Baixar"}),t.jsx("button",{onClick:n,className:"close-button",children:"❌ Fechar"})]}),_=({celestialBody:e,setCelestialBody:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:e==="sun"?"active":"",onClick:()=>n("sun"),children:"☀️ Sol"}),t.jsx("button",{className:e==="moon"?"active":"",onClick:()=>n("moon"),children:"🌙 Lua"})]})}),E=e=>e?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--",T=({sunTimes:e,isDaytime:n})=>t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"☀️ Nascer do sol"}),t.jsx("strong",{children:E(e==null?void 0:e.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌇 Pôr do sol"}),t.jsx("strong",{children:E(e==null?void 0:e.sunset)})]})]}),ee=({moonPhase:e})=>t.jsxs("div",{className:"info-card moon-phase moon-phase-card",children:[t.jsxs("span",{children:[e.emoji," Fase"]}),t.jsx("strong",{children:e.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${e.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(e.fraction*100),"% iluminada"]})]}),te=({moonTimes:e,moonPhase:n})=>t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌕 Nascer da lua"}),t.jsx("strong",{children:E(e==null?void 0:e.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌑 Pôr da lua"}),t.jsx("strong",{children:E(e==null?void 0:e.moonset)})]}),t.jsx(ee,{moonPhase:n})]}),F=({angle:e,isActive:n,indicator:a,className:o})=>t.jsx("div",{className:`direction-arrow ${n?"active":"secondary"} ${o}`,style:{transform:`rotate(${e}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:a})}),ne=({celestialBody:e,smoothedSunAngle:n,smoothedMoonAngle:a,moonPhase:o})=>t.jsx("div",{className:"compass-wrapper",children:t.jsxs("div",{className:"compass",children:[t.jsx(F,{angle:n,isActive:e==="sun",indicator:"☀️",className:"sun-indicator"}),t.jsx(F,{angle:a,isActive:e==="moon",indicator:o.emoji,className:"moon-indicator"})]})}),se=({messages:e})=>t.jsx("div",{className:"error-container",children:e.map((n,a)=>t.jsx("div",{className:"error-banner",children:n},a))});function re(){const[e,n]=s.useState(null),[a,o]=s.useState(null);return s.useEffect(()=>{const r=h=>{n({lat:h.coords.latitude,lng:h.coords.longitude})},i=h=>{o(h.message||"Erro ao obter localização")};if(!navigator.geolocation){o("Geolocalização não suportada");return}navigator.geolocation.getCurrentPosition(r,i,{enableHighAccuracy:!0,timeout:5e3});const d=navigator.geolocation.watchPosition(r,i,{enableHighAccuracy:!0,timeout:1e4});return()=>{navigator.geolocation.clearWatch(d)}},[]),{position:e,error:a}}const oe=e=>e===null?0:(360-e)%360,k=e=>(e%360+360)%360,R=(e,n,a)=>{if(e===void 0)return n;let o=(n-e+180)%360-180;return o=o<-180?o+360:o,e+o*a},ae=(e,n)=>{const a=Math.abs(e-n)%360;return Math.min(a,360-a)};function ie(){const[e,n]=s.useState(null),[a,o]=s.useState(null);return s.useEffect(()=>{const r=i=>{if(i.alpha!==null){let d=i.alpha;typeof i.webkitCompassHeading<"u"&&(d=i.webkitCompassHeading),n(oe(d))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",r,!0):o("Sensor de orientação não suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",r)}},[]),{deviceHeading:e,error:a}}function ce(){const[e,n]=s.useState(!1),[a,o]=s.useState(null),[r,i]=s.useState("environment"),[d,h]=s.useState(null),l=s.useRef(null),p=s.useRef(null),f=s.useCallback(async()=>{try{if(l.current&&l.current.srcObject)return;const c={video:{facingMode:r,width:{ideal:1280},height:{ideal:720}}},u=await navigator.mediaDevices.getUserMedia(c);l.current&&(l.current.srcObject=u,l.current.onloadedmetadata=()=>{l.current.play().catch(g=>{h("Erro ao reproduzir vídeo: "+g.message)})})}catch(c){h("Erro ao acessar câmera: "+c.message),n(!1)}},[r]);s.useEffect(()=>{var c;e?f():(c=l.current)!=null&&c.srcObject&&(l.current.srcObject.getTracks().forEach(u=>u.stop()),l.current.srcObject=null)},[e,f]),s.useEffect(()=>{e&&f()},[r,e,f]);const v=()=>{i(c=>c==="user"?"environment":"user")},m=s.useCallback(()=>{const c=l.current,u=p.current;if(c&&u&&c.readyState>=2){u.width=c.videoWidth,u.height=c.videoHeight;const g=u.getContext("2d");r==="user"&&(g.translate(u.width,0),g.scale(-1,1)),g.drawImage(c,0,0,u.width,u.height),o(u.toDataURL("image/jpeg",.9))}},[r]),j=s.useCallback(()=>{n(!1),o(null)},[]);return{cameraActive:e,setCameraActive:n,photo:a,setPhoto:o,facingMode:r,toggleCamera:v,capturePhoto:m,closeCamera:j,videoRef:l,canvasRef:p,cameraError:d}}const le=(e,n)=>{const a=new Date,o=w.getPosition(a,e,n);return H((o.azimuth*180/Math.PI+180)%360)},ue=(e,n)=>{const a=new Date,o=w.getMoonPosition(a,e,n);return H((o.azimuth*180/Math.PI+180)%360)},de=e=>e===0?"🌑":e<.25?"🌒":e<.5?"🌓":e<.75?"🌔":e===1?"🌕":e>.75?"🌖":e>.5?"🌗":"🌘",me=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final",H=e=>(e%360+360)%360;function fe(e){const[n,a]=s.useState(0),[o,r]=s.useState(0),[i,d]=s.useState({sunrise:null,sunset:null}),[h,l]=s.useState({moonrise:null,moonset:null}),[p,f]=s.useState({fraction:0,phase:0,emoji:"🌑",name:"Lua Nova"}),[v,m]=s.useState(!1);return s.useEffect(()=>{if(!e)return;const j=()=>{const u=new Date,g=w.getTimes(u,e.lat,e.lng),P=w.getPosition(u,e.lat,e.lng);d({sunrise:g.sunrise,sunset:g.sunset}),m(P.altitude>0);const b=w.getMoonTimes(u,e.lat,e.lng);l({moonrise:b.rise,moonset:b.set});const x=w.getMoonIllumination(u);f({fraction:x.fraction,phase:x.phase,emoji:de(x.fraction),name:me(x.phase)})};j();const c=setInterval(j,6e4);return()=>clearInterval(c)},[e]),s.useEffect(()=>{if(!e)return;const j=()=>{a(le(e.lat,e.lng)),r(ue(e.lat,e.lng))};j();const c=setInterval(j,6e4);return()=>clearInterval(c)},[e]),{sunAzimuth:n,moonAzimuth:o,sunTimes:i,moonTimes:h,moonPhase:p,isDaytime:v}}const he=()=>{const[e,n]=s.useState("sun"),[a,o]=s.useState(0),[r,i]=s.useState(0),{position:d,error:h}=re(),{deviceHeading:l,error:p}=ie(),{sunAzimuth:f,moonAzimuth:v,sunTimes:m,moonTimes:j,moonPhase:c,isDaytime:u}=fe(d),{cameraActive:g,setCameraActive:P,photo:b,setPhoto:x,facingMode:G,toggleCamera:U,capturePhoto:B,closeCamera:q,videoRef:Q,canvasRef:W,error:K}=ce(),y=s.useRef(null),[A,M]=s.useState("default"),[D,L]=s.useState(!1);s.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(N=>{M(N)}):M(Notification.permission))},[]);const z=s.useCallback(()=>{if(y.current&&clearTimeout(y.current),!(m!=null&&m.sunset))return;const N=new Date(m.sunset.getTime()-15*6e4),C=new Date;if(N<=C)return;const S=N-C;y.current=setTimeout(()=>{A==="granted"&&new Notification("O pôr do sol está próximo!",{body:"Faltam 15 minutos para o pôr do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),L(!1)},S),L(!0)},[m,A]);s.useEffect(()=>{m!=null&&m.sunset&&A==="granted"&&!D&&z()},[m,A,D,z]),s.useEffect(()=>{if(f===null||v===null||l===null)return;const N=k(f-l),C=k(v-l);o(S=>R(S,N,.2)),i(S=>R(S,C,.2))},[f,v,l]);const O=e==="sun"?f:v,I=O!==null&&l!==null&&ae(O,l)<15,$=[h,p,K].filter(Boolean);return t.jsxs(V,{isDaytime:u,children:[t.jsx("h1",{children:e==="sun"?"🌅 Localizando o Sol":"🌙 Localizando a Lua"}),t.jsx(_,{celestialBody:e,setCelestialBody:n}),e==="sun"?t.jsx(T,{sunTimes:m}):t.jsx(te,{moonTimes:j,moonPhase:c}),g&&t.jsxs("div",{className:"camera-container",children:[t.jsx(X,{videoRef:Q,facingMode:G}),t.jsx(Y,{toggleCamera:U,capturePhoto:B,closeCamera:q}),b&&t.jsx(Z,{photo:b,closePreview:()=>x(null)})]}),t.jsx(ne,{celestialBody:e,smoothedSunAngle:a,smoothedMoonAngle:r,moonPhase:c}),!g&&t.jsx("button",{className:"main-camera-btn",onClick:()=>P(!0),children:"📸 Ativar Câmera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["🧭 Direção: ",e==="sun"?`${f?f.toFixed(1):"--"}° (Sol)`:`${v?v.toFixed(1):"--"}° (Lua)`]}),t.jsx("div",{className:`alignment-feedback ${I?"aligned":""}`,children:I?`⭐ ALINHADO COM ${e==="sun"?"O SOL":"A LUA"}! ⭐`:`Gire o dispositivo para ${e==="sun"?"o Sol":"a Lua"}... ➡️`})]}),$.length>0&&t.jsx(se,{messages:$}),t.jsx("canvas",{ref:W,style:{display:"none"}})]})};J.createRoot(document.getElementById("root")).render(t.jsx(s.StrictMode,{children:t.jsx(he,{})}));
//# sourceMappingURL=index-Kzg7Ip8B.js.map
