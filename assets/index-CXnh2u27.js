import{r as n,j as t,c as Y}from"./react-vendor-BzzwJzSH.js";import{s as g}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const j of c.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&p(j)}).observe(document,{childList:!0,subtree:!0});function f(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(a){if(a.ep)return;a.ep=!0;const c=f(a);fetch(a.href,c)}})();const Z=(o,d)=>{const f=new Date,p=g.getTimes(f,o,d).sunset;return(g.getPosition(p,o,d).azimuth*180/Math.PI+180)%360},_=o=>(360-o)%360,ee=()=>{const[o,d]=n.useState(null),[f,p]=n.useState(0),[a,c]=n.useState(0),[j,x]=n.useState(null),[b,E]=n.useState(!1),[C,O]=n.useState(null),[w,$]=n.useState("environment"),[F,R]=n.useState(!1),[l,H]=n.useState({sunrise:null,sunset:null,solarNoon:null}),[u,M]=n.useState("sun"),[A,B]=n.useState(0),[v,G]=n.useState({moonrise:null,moonset:null}),[N,U]=n.useState({fraction:0,phase:0,emoji:"🌑"}),i=n.useRef(null),L=n.useRef(null),h=n.useRef(null),[S,D]=n.useState("default"),[z,T]=n.useState(!1),q=e=>e===0?"🌑":e<.25?"🌒":e<.5?"🌓":e<.75?"🌔":e===1?"🌕":e>.75?"🌖":e>.5?"🌗":"🌘",Q=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final";n.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(e=>{D(e)}):D(Notification.permission))},[]),n.useEffect(()=>{const e=r=>{d({lat:r.coords.latitude,lng:r.coords.longitude})},s=r=>{x(r.message||"Erro ao obter localização")};if(!navigator.geolocation){x("Geolocalização não suportada");return}navigator.geolocation.getCurrentPosition(e,s,{enableHighAccuracy:!0,timeout:5e3})},[]),n.useEffect(()=>{if(o){const e=Z(o.lat,o.lng);p(e);const s=new Date,m=(g.getMoonPosition(s,o.lat,o.lng).azimuth*180/Math.PI+180)%360;B(m)}},[o]),n.useEffect(()=>{const e=s=>{if(s.alpha!==null){let r=s.alpha;typeof s.webkitCompassHeading<"u"&&(r=s.webkitCompassHeading),c(_(r))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",e,!0):x("Sensor de orientação não suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",e)}},[]),n.useEffect(()=>{if(o){const e=()=>{const r=new Date,m=g.getTimes(r,o.lat,o.lng),X=g.getPosition(r,o.lat,o.lng);H({sunrise:m.sunrise,sunset:m.sunset,solarNoon:m.solarNoon}),R(X.altitude>0);const k=g.getMoonTimes(r,o.lat,o.lng);G({moonrise:k.rise,moonset:k.set});const y=g.getMoonIllumination(r);U({fraction:y.fraction,phase:y.phase,emoji:q(y.fraction),name:Q(y.phase)})};e();const s=setInterval(e,6e4);return()=>{clearInterval(s),h.current&&clearTimeout(h.current)}}},[o]),n.useEffect(()=>{l.sunset&&S==="granted"&&!z&&K()},[l,S,z]);const K=n.useCallback(()=>{if(h.current&&clearTimeout(h.current),!l.sunset)return;const e=new Date(l.sunset.getTime()-15*6e4),s=new Date;if(e<=s)return;const r=e-s;h.current=setTimeout(()=>{S==="granted"&&new Notification("O pôr do sol está próximo!",{body:"Faltam 15 minutos para o pôr do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),T(!1)},r),T(!0)},[l,S]);n.useEffect(()=>{let e=null;return b&&(async()=>{try{if(i.current&&i.current.srcObject)return;const r={video:{facingMode:w,width:{ideal:1280},height:{ideal:720}}};i.current&&i.current.srcObject&&(i.current.srcObject.getTracks().forEach(m=>m.stop()),i.current.srcObject=null),e=await navigator.mediaDevices.getUserMedia(r),i.current&&(i.current.srcObject=e,i.current.onloadedmetadata=()=>{i.current.play().catch(m=>{x("Erro ao reproduzir vídeo: "+m.message)})})}catch(r){x("Erro ao acessar câmera: "+r.message),E(!1)}})(),()=>{e&&e.getTracks().forEach(r=>r.stop())}},[b,w]);const W=()=>{$(e=>e==="user"?"environment":"user")},J=()=>{const e=i.current,s=L.current;if(e&&s&&e.readyState>=2){s.width=e.videoWidth,s.height=e.videoHeight;const r=s.getContext("2d");w==="user"&&(r.translate(s.width,0),r.scale(-1,1)),r.drawImage(e,0,0,s.width,s.height),O(s.toDataURL("image/jpeg",.9))}},V=()=>{var e;(e=i.current)!=null&&e.srcObject&&(i.current.srcObject.getTracks().forEach(s=>s.stop()),i.current.srcObject=null),E(!1),O(null)};n.useEffect(()=>()=>{var e;(e=i.current)!=null&&e.srcObject&&i.current.srcObject.getTracks().forEach(s=>s.stop()),h.current&&clearTimeout(h.current)},[]);const I=Math.abs((()=>{let s=((u==="sun"?f:A)-a+360)%360;return s>180&&(s-=360),s})())<15;return t.jsxs("div",{className:`app-container ${F?"day-theme":"night-theme"}`,children:[t.jsx("h1",{children:u==="sun"?"🌅 Localizando o Pôr do Sol":"🌙 Localizando a Lua"}),t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:u==="sun"?"active":"",onClick:()=>M("sun"),children:"☀️ Sol"}),t.jsx("button",{className:u==="moon"?"active":"",onClick:()=>M("moon"),children:"🌙 Lua"})]}),t.jsx("div",{className:"celestial-info",children:u==="sun"?t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"☀️ Nascer do sol"}),t.jsx("strong",{children:P(l==null?void 0:l.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌇 Pôr do sol"}),t.jsx("strong",{children:P(l==null?void 0:l.sunset)})]})]}):t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌕 Nascer da lua"}),t.jsx("strong",{children:P(v==null?void 0:v.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌑 Pôr da lua"}),t.jsx("strong",{children:P(v==null?void 0:v.moonset)})]}),t.jsxs("div",{className:"info-card moon-phase",children:[t.jsxs("span",{children:[N.emoji," Fase"]}),t.jsx("strong",{children:N.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${N.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(N.fraction*100),"% iluminada"]})]})]})}),b&&t.jsxs("div",{className:"camera-container",children:[t.jsx("video",{ref:i,className:`camera-preview${w==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:W,"aria-label":"Alternar câmera",children:"🔄"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:J,"aria-label":"Capturar foto",children:"⭕"}),t.jsx("button",{className:"camera-btn",onClick:V,"aria-label":"Fechar câmera",children:"✖"})]}),C&&t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:C,alt:"Foto capturada"}),t.jsx("a",{href:C,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"⬇️ Baixar"}),t.jsx("button",{onClick:()=>O(null),className:"close-button",children:"❌ Fechar"})]})]}),t.jsxs("div",{className:"compass-wrapper",children:[t.jsxs("div",{className:"compass",children:[t.jsx("div",{className:`direction-arrow ${u==="sun"?"active":"secondary"}`,style:{transform:`rotate(${f-a}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:"☀️"})}),t.jsx("div",{className:`direction-arrow ${u==="moon"?"active":"secondary"}`,style:{transform:`rotate(${A-a}deg)`},children:t.jsx("div",{className:"celestial-indicator moon-indicator",children:N.emoji})}),t.jsx("div",{className:"alignment-marker"})]}),!b&&t.jsx("button",{className:"main-camera-btn",onClick:()=>E(!0),children:"📸 Ativar Câmera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["🧭 Direção: ",u==="sun"?f.toFixed(1)+"° (Sol)":A.toFixed(1)+"° (Lua)"]}),t.jsx("div",{className:`alignment-feedback ${I?"aligned":""}`,children:I?`⭐ ALINHADO COM ${u==="sun"?"O SOL":"A LUA"}! ⭐`:`Gire o dispositivo para ${u==="sun"?"o Sol":"a Lua"}... ➡️`})]})]}),j&&t.jsx("div",{className:"error-banner",children:j}),t.jsx("canvas",{ref:L,style:{display:"none"}})]})};function P(o){return o?new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}Y.createRoot(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(ee,{})}));
//# sourceMappingURL=index-CXnh2u27.js.map
