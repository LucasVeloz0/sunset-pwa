import{r,j as t,c as $}from"./react-vendor-BzzwJzSH.js";import{s as N}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function m(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function h(i){if(i.ep)return;i.ep=!0;const c=m(i);fetch(i.href,c)}})();const U=(o,u)=>{const m=new Date,h=N.getTimes(m,o,u).sunset;return(N.getPosition(h,o,u).azimuth*180/Math.PI+180)%360},q=o=>(360-o)%360,B=()=>{const[o,u]=r.useState(null),[m,h]=r.useState(0),[i,c]=r.useState(0),[p,g]=r.useState(null),[v,b]=r.useState(!1),[w,E]=r.useState(null),[j,T]=r.useState("environment"),[L,k]=r.useState(!1),[l,z]=r.useState({sunrise:null,sunset:null,solarNoon:null}),a=r.useRef(null),y=r.useRef(null),d=r.useRef(null),[x,S]=r.useState("default"),[O,P]=r.useState(!1);r.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(e=>{S(e)}):S(Notification.permission))},[]),r.useEffect(()=>{const e=n=>{u({lat:n.coords.latitude,lng:n.coords.longitude})},s=n=>{g(n.message||"Erro ao obter localiza√ß√£o")};if(!navigator.geolocation){g("Geolocaliza√ß√£o n√£o suportada");return}navigator.geolocation.getCurrentPosition(e,s,{enableHighAccuracy:!0,timeout:5e3})},[]),r.useEffect(()=>{if(o){const e=U(o.lat,o.lng);h(e)}},[o]),r.useEffect(()=>{const e=s=>{if(s.alpha!==null){let n=s.alpha;typeof s.webkitCompassHeading<"u"&&(n=s.webkitCompassHeading),c(q(n))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",e,!0):g("Sensor de orienta√ß√£o n√£o suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",e)}},[]),r.useEffect(()=>{if(o){const e=()=>{const n=new Date,f=N.getTimes(n,o.lat,o.lng),M=N.getPosition(n,o.lat,o.lng);z({sunrise:f.sunrise,sunset:f.sunset,solarNoon:f.solarNoon}),k(M.altitude>0)};e();const s=setInterval(e,6e4);return()=>{clearInterval(s),d.current&&clearTimeout(d.current)}}},[o]),r.useEffect(()=>{l.sunset&&x==="granted"&&!O&&I()},[l,x,O]);const I=r.useCallback(()=>{if(d.current&&clearTimeout(d.current),!l.sunset)return;const e=new Date(l.sunset.getTime()-15*6e4),s=new Date;if(e<=s)return;const n=e-s;d.current=setTimeout(()=>{x==="granted"&&new Notification("O p√¥r do sol est√° pr√≥ximo!",{body:"Faltam 15 minutos para o p√¥r do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),P(!1)},n),P(!0)},[l,x]);r.useEffect(()=>{let e=null;return v&&(async()=>{try{if(a.current&&a.current.srcObject)return;const n={video:{facingMode:j,width:{ideal:1280},height:{ideal:720}}};a.current&&a.current.srcObject&&(a.current.srcObject.getTracks().forEach(f=>f.stop()),a.current.srcObject=null),e=await navigator.mediaDevices.getUserMedia(n),a.current&&(a.current.srcObject=e,a.current.onloadedmetadata=()=>{a.current.play().catch(f=>{g("Erro ao reproduzir v√≠deo: "+f.message)})})}catch(n){g("Erro ao acessar c√¢mera: "+n.message),b(!1)}})(),()=>{e&&e.getTracks().forEach(n=>n.stop())}},[v,j]);const R=()=>{T(e=>e==="user"?"environment":"user")},F=()=>{const e=a.current,s=y.current;if(e&&s&&e.readyState>=2){s.width=e.videoWidth,s.height=e.videoHeight;const n=s.getContext("2d");j==="user"&&(n.translate(s.width,0),n.scale(-1,1)),n.drawImage(e,0,0,s.width,s.height),E(s.toDataURL("image/jpeg",.9))}},H=()=>{var e;(e=a.current)!=null&&e.srcObject&&(a.current.srcObject.getTracks().forEach(s=>s.stop()),a.current.srcObject=null),b(!1),E(null)};r.useEffect(()=>()=>{var e;(e=a.current)!=null&&e.srcObject&&a.current.srcObject.getTracks().forEach(s=>s.stop()),d.current&&clearTimeout(d.current)},[]);const C=()=>{let e=(m-i+360)%360;return e>180&&(e-=360),e},D=Math.abs(C())<15;return t.jsxs("div",{className:`app-container ${L?"day-theme":"night-theme"}`,children:[t.jsx("h1",{children:"üåÖ Localizando o P√¥r do Sol"}),t.jsxs("div",{className:"sun-info",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"‚òÄÔ∏è Nascer do sol"}),t.jsx("strong",{children:A(l==null?void 0:l.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"üåá P√¥r do sol"}),t.jsx("strong",{children:A(l==null?void 0:l.sunset)})]})]}),v&&t.jsxs("div",{className:"camera-container",children:[t.jsx("video",{ref:a,className:`camera-preview${j==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:R,"aria-label":"Alternar c√¢mera",children:"üîÑ"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:F,"aria-label":"Capturar foto",children:"‚≠ï"}),t.jsx("button",{className:"camera-btn",onClick:H,"aria-label":"Fechar c√¢mera",children:"‚úñ"})]}),w&&t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:w,alt:"Foto capturada"}),t.jsx("a",{href:w,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"‚¨áÔ∏è Baixar"}),t.jsx("button",{onClick:()=>E(null),className:"close-button",children:"‚ùå Fechar"})]})]}),t.jsxs("div",{className:"compass-wrapper",children:[t.jsxs("div",{className:"compass",children:[t.jsx("div",{className:"direction-arrow",style:{transform:`rotate(${C()}deg)`},children:t.jsx("div",{className:"sun-indicator",children:"‚òÄÔ∏è"})}),t.jsx("div",{className:"alignment-marker"})]}),!v&&t.jsx("button",{className:"main-camera-btn",onClick:()=>b(!0),children:"üì∏ Ativar C√¢mera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["üß≠ Dire√ß√£o: ",m.toFixed(1),"¬∞"]}),t.jsx("div",{className:`alignment-feedback ${D?"aligned":""}`,children:D?"‚≠ê ALINHADO! ‚≠ê":"Gire o dispositivo... ‚û°Ô∏è"})]})]}),p&&t.jsx("div",{className:"error-banner",children:p}),t.jsx("canvas",{ref:y,style:{display:"none"}})]})};function A(o){return o?new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}$.createRoot(document.getElementById("root")).render(t.jsx(r.StrictMode,{children:t.jsx(B,{})}));
//# sourceMappingURL=index-BiONaVKz.js.map
