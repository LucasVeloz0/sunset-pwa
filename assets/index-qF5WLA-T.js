import{r as s,j as t,c as ie}from"./react-vendor-BzzwJzSH.js";import{s as p}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))j(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const x of c.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&j(x)}).observe(document,{childList:!0,subtree:!0});function m(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function j(i){if(i.ep)return;i.ep=!0;const c=m(i);fetch(i.href,c)}})();const ae=(o,u)=>{const m=new Date,j=p.getTimes(m,o,u).sunset;return(p.getPosition(j,o,u).azimuth*180/Math.PI+180)%360},ce=o=>(360-o)%360;function L(o){return(o%360+360)%360}function A(o,u){const m=(u-o+180)%360-180;return o+m}const le=()=>{const[o,u]=s.useState(null),[m,j]=s.useState(0),[i,c]=s.useState(0),[x,b]=s.useState(null),[S,M]=s.useState(!1),[O,D]=s.useState(null),[y,G]=s.useState("environment"),[U,q]=s.useState(!1),[d,Q]=s.useState({sunrise:null,sunset:null,solarNoon:null}),[h,T]=s.useState("sun"),[z,K]=s.useState(0),[v,W]=s.useState({moonrise:null,moonset:null}),[w,J]=s.useState({fraction:0,phase:0,emoji:"🌑"}),a=s.useRef(null),I=s.useRef(null),g=s.useRef(null),[E,R]=s.useState("default"),[k,F]=s.useState(!1),[V,X]=s.useState(0),[Y,Z]=s.useState(0),$=s.useRef(0),H=s.useRef(0),_=e=>e===0?"🌑":e<.25?"🌒":e<.5?"🌓":e<.75?"🌔":e===1?"🌕":e>.75?"🌖":e>.5?"🌗":"🌘",ee=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final";s.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(e=>{R(e)}):R(Notification.permission))},[]),s.useEffect(()=>{const e=r=>{u({lat:r.coords.latitude,lng:r.coords.longitude})},n=r=>{b(r.message||"Erro ao obter localização")};if(!navigator.geolocation){b("Geolocalização não suportada");return}navigator.geolocation.getCurrentPosition(e,n,{enableHighAccuracy:!0,timeout:5e3})},[]),s.useEffect(()=>{if(o){const e=ae(o.lat,o.lng);j(e);const n=new Date,l=(p.getMoonPosition(n,o.lat,o.lng).azimuth*180/Math.PI+180)%360;K(l)}},[o]),s.useEffect(()=>{const e=n=>{if(n.alpha!==null){let r=n.alpha;typeof n.webkitCompassHeading<"u"&&(r=n.webkitCompassHeading),c(ce(r))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",e,!0):b("Sensor de orientação não suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",e)}},[]),s.useEffect(()=>{if(o){const e=()=>{const r=new Date,l=p.getTimes(r,o.lat,o.lng),f=p.getPosition(r,o.lat,o.lng);Q({sunrise:l.sunrise,sunset:l.sunset,solarNoon:l.solarNoon}),q(f.altitude>0);const N=p.getMoonTimes(r,o.lat,o.lng);W({moonrise:N.rise,moonset:N.set});const P=p.getMoonIllumination(r);J({fraction:P.fraction,phase:P.phase,emoji:_(P.fraction),name:ee(P.phase)})};e();const n=setInterval(e,6e4);return()=>{clearInterval(n),g.current&&clearTimeout(g.current)}}},[o]),s.useEffect(()=>{d.sunset&&E==="granted"&&!k&&te()},[d,E,k]);const te=s.useCallback(()=>{if(g.current&&clearTimeout(g.current),!d.sunset)return;const e=new Date(d.sunset.getTime()-15*6e4),n=new Date;if(e<=n)return;const r=e-n;g.current=setTimeout(()=>{E==="granted"&&new Notification("O pôr do sol está próximo!",{body:"Faltam 15 minutos para o pôr do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),F(!1)},r),F(!0)},[d,E]);s.useEffect(()=>{let e=null;return S&&(async()=>{try{if(a.current&&a.current.srcObject)return;const r={video:{facingMode:y,width:{ideal:1280},height:{ideal:720}}};a.current&&a.current.srcObject&&(a.current.srcObject.getTracks().forEach(l=>l.stop()),a.current.srcObject=null),e=await navigator.mediaDevices.getUserMedia(r),a.current&&(a.current.srcObject=e,a.current.onloadedmetadata=()=>{a.current.play().catch(l=>{b("Erro ao reproduzir vídeo: "+l.message)})})}catch(r){b("Erro ao acessar câmera: "+r.message),M(!1)}})(),()=>{e&&e.getTracks().forEach(r=>r.stop())}},[S,y]);const ne=()=>{G(e=>e==="user"?"environment":"user")},se=()=>{const e=a.current,n=I.current;if(e&&n&&e.readyState>=2){n.width=e.videoWidth,n.height=e.videoHeight;const r=n.getContext("2d");y==="user"&&(r.translate(n.width,0),r.scale(-1,1)),r.drawImage(e,0,0,n.width,n.height),D(n.toDataURL("image/jpeg",.9))}},oe=()=>{var e;(e=a.current)!=null&&e.srcObject&&(a.current.srcObject.getTracks().forEach(n=>n.stop()),a.current.srcObject=null),M(!1),D(null)};s.useEffect(()=>()=>{var e;(e=a.current)!=null&&e.srcObject&&a.current.srcObject.getTracks().forEach(n=>n.stop()),g.current&&clearTimeout(g.current)},[]);function re(e){const n=Math.abs(L(e)-180)%360;return n>180?360-n:n}s.useEffect(()=>{const e=L(m-i),n=L(z-i),r=A($.current,e),l=A(H.current,n);$.current=r,H.current=l,X(f=>{const N=A(f,r)-f;return f+N*.2}),Z(f=>{const N=A(f,l)-f;return f+N*.2})},[m,z,i]);const B=re(h==="sun"?m:z)<15;return t.jsxs("div",{className:`app-container ${U?"day-theme":"night-theme"}`,children:[t.jsx("h1",{children:h==="sun"?"🌅 Localizando o Sol":"🌙 Localizando a Lua"}),t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:h==="sun"?"active":"",onClick:()=>T("sun"),children:"☀️ Sol"}),t.jsx("button",{className:h==="moon"?"active":"",onClick:()=>T("moon"),children:"🌙 Lua"})]}),t.jsx("div",{className:"celestial-info",children:h==="sun"?t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"☀️ Nascer do sol"}),t.jsx("strong",{children:C(d==null?void 0:d.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌇 Pôr do sol"}),t.jsx("strong",{children:C(d==null?void 0:d.sunset)})]})]}):t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌕 Nascer da lua"}),t.jsx("strong",{children:C(v==null?void 0:v.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌑 Pôr da lua"}),t.jsx("strong",{children:C(v==null?void 0:v.moonset)})]}),t.jsxs("div",{className:"info-card moon-phase",children:[t.jsxs("span",{children:[w.emoji," Fase"]}),t.jsx("strong",{children:w.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${w.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(w.fraction*100),"% iluminada"]})]})]})}),S&&t.jsxs("div",{className:"camera-container",children:[t.jsx("video",{ref:a,className:`camera-preview${y==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:ne,"aria-label":"Alternar câmera",children:"🔄"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:se,"aria-label":"Capturar foto",children:"⭕"}),t.jsx("button",{className:"camera-btn",onClick:oe,"aria-label":"Fechar câmera",children:"✖"})]}),O&&t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:O,alt:"Foto capturada"}),t.jsx("a",{href:O,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"⬇️ Baixar"}),t.jsx("button",{onClick:()=>D(null),className:"close-button",children:"❌ Fechar"})]})]}),t.jsxs("div",{className:"compass-wrapper ",children:[t.jsxs("div",{className:"compass",children:[t.jsx("div",{className:`direction-arrow ${h==="sun"?"active":"secondary"}`,style:{transform:`rotate(${-V}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:"☀️"})}),t.jsx("div",{className:`direction-arrow ${h==="moon"?"active":"secondary"}`,style:{transform:`rotate(${-Y}deg)`},children:t.jsx("div",{className:"celestial-indicator moon-indicator",children:w.emoji})})]}),!S&&t.jsx("button",{className:"main-camera-btn",onClick:()=>M(!0),children:"📸 Ativar Câmera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["🧭 Direção: ",m.toFixed(1),"°"]}),t.jsx("div",{className:`alignment-feedback ${B?"aligned":""}`,children:B?"⭐ ALINHADO! ⭐":"Gire o dispositivo... ➡️"})]})]}),x&&t.jsx("div",{className:"error-banner",children:x}),t.jsx("canvas",{ref:I,style:{display:"none"}})]})};function C(o){return o?new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}ie.createRoot(document.getElementById("root")).render(t.jsx(s.StrictMode,{children:t.jsx(le,{})}));
//# sourceMappingURL=index-qF5WLA-T.js.map
