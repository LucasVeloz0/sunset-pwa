import{r as o,j as t,c as oe}from"./react-vendor-BzzwJzSH.js";import{s as v}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))m(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&m(p)}).observe(document,{childList:!0,subtree:!0});function l(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function m(i){if(i.ep)return;i.ep=!0;const u=l(i);fetch(i.href,u)}})();const re=(n,d)=>{const l=new Date;return(v.getPosition(l,n,d).azimuth*180/Math.PI+180)%360},ie=(n,d)=>{const l=new Date;return(v.getMoonPosition(l,n,d).azimuth*180/Math.PI+180)%360},ae=n=>(360-n)%360,F=(n,d,l)=>{let m=d-n;return m>180&&(m-=360),m<-180&&(m+=360),n+m*l},ce=n=>(n=n%360,n>180&&(n-=360),n<-180&&(n+=360),n),le=()=>{const[n,d]=o.useState(null),[l,m]=o.useState(0),[i,u]=o.useState(0),[p,x]=o.useState(null),[w,C]=o.useState(!1),[E,M]=o.useState(null),[S,R]=o.useState("environment"),[H,B]=o.useState(!1),[f,G]=o.useState({sunrise:null,sunset:null,solarNoon:null}),[h,O]=o.useState("sun"),[N,U]=o.useState(0),[j,q]=o.useState({moonrise:null,moonset:null}),[b,Q]=o.useState({fraction:0,phase:0,emoji:"🌑"}),a=o.useRef(null),z=o.useRef(null),g=o.useRef(null),[A,L]=o.useState("default"),[D,I]=o.useState(!1),[W,K]=o.useState(i||0),[J,V]=o.useState(i||0),X=e=>e===0?"🌑":e<.25?"🌒":e<.5?"🌓":e<.75?"🌔":e===1?"🌕":e>.75?"🌖":e>.5?"🌗":"🌘",Y=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final";o.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(e=>{L(e)}):L(Notification.permission))},[]),o.useEffect(()=>{const e=c=>{d({lat:c.coords.latitude,lng:c.coords.longitude})},s=c=>{x(c.message||"Erro ao obter localização")};if(!navigator.geolocation){x("Geolocalização não suportada");return}navigator.geolocation.getCurrentPosition(e,s,{enableHighAccuracy:!0,timeout:5e3});const r=navigator.geolocation.watchPosition(e,s,{enableHighAccuracy:!0,timeout:1e4});return()=>{navigator.geolocation.clearWatch(r)}},[]),o.useEffect(()=>{if(n){const e=()=>{const r=re(n.lat,n.lng);m(r);const c=ie(n.lat,n.lng);U(c)};e();const s=setInterval(e,6e4);return()=>clearInterval(s)}},[n]),o.useEffect(()=>{const e=s=>{if(s.alpha!==null){let r=s.alpha;typeof s.webkitCompassHeading<"u"&&(r=s.webkitCompassHeading),u(ae(r))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",e,!0):x("Sensor de orientação não suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",e)}},[]),o.useEffect(()=>{if(n){const e=()=>{const r=new Date,c=v.getTimes(r,n.lat,n.lng),se=v.getPosition(r,n.lat,n.lng);G({sunrise:c.sunrise,sunset:c.sunset,solarNoon:c.solarNoon}),B(se.altitude>0);const k=v.getMoonTimes(r,n.lat,n.lng);q({moonrise:k.rise,moonset:k.set});const y=v.getMoonIllumination(r);Q({fraction:y.fraction,phase:y.phase,emoji:X(y.fraction),name:Y(y.phase)})};e();const s=setInterval(e,6e4);return()=>{clearInterval(s),g.current&&clearTimeout(g.current)}}},[n]),o.useEffect(()=>{f.sunset&&A==="granted"&&!D&&Z()},[f,A,D]);const Z=o.useCallback(()=>{if(g.current&&clearTimeout(g.current),!f.sunset)return;const e=new Date(f.sunset.getTime()-15*6e4),s=new Date;if(e<=s)return;const r=e-s;g.current=setTimeout(()=>{A==="granted"&&new Notification("O pôr do sol está próximo!",{body:"Faltam 15 minutos para o pôr do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),I(!1)},r),I(!0)},[f,A]);o.useEffect(()=>{let e=null;return w&&(async()=>{try{if(a.current&&a.current.srcObject)return;const r={video:{facingMode:S,width:{ideal:1280},height:{ideal:720}}};a.current&&a.current.srcObject&&(a.current.srcObject.getTracks().forEach(c=>c.stop()),a.current.srcObject=null),e=await navigator.mediaDevices.getUserMedia(r),a.current&&(a.current.srcObject=e,a.current.onloadedmetadata=()=>{a.current.play().catch(c=>{x("Erro ao reproduzir vídeo: "+c.message)})})}catch(r){x("Erro ao acessar câmera: "+r.message),C(!1)}})(),()=>{e&&e.getTracks().forEach(r=>r.stop())}},[w,S]);const _=()=>{R(e=>e==="user"?"environment":"user")},ee=()=>{const e=a.current,s=z.current;if(e&&s&&e.readyState>=2){s.width=e.videoWidth,s.height=e.videoHeight;const r=s.getContext("2d");S==="user"&&(r.translate(s.width,0),r.scale(-1,1)),r.drawImage(e,0,0,s.width,s.height),M(s.toDataURL("image/jpeg",.9))}},te=()=>{var e;(e=a.current)!=null&&e.srcObject&&(a.current.srcObject.getTracks().forEach(s=>s.stop()),a.current.srcObject=null),C(!1),M(null)};o.useEffect(()=>()=>{var e;(e=a.current)!=null&&e.srcObject&&a.current.srcObject.getTracks().forEach(s=>s.stop()),g.current&&clearTimeout(g.current)},[]);const ne=e=>{const s=Math.abs(e-i)%360;return Math.min(s,360-s)},$=e=>ce(e-i);o.useEffect(()=>{if(l===null||N===null||i===null)return;const e=$(l),s=$(N);K(r=>F(r,e,.2)),V(r=>F(r,s,.2))},[l,N,i]);const T=ne(h==="sun"?l:N)<15;return t.jsxs("div",{className:`app-container ${H?"day-theme":"night-theme"}`,children:[t.jsx("h1",{children:h==="sun"?"🌅 Localizando o Sol":"🌙 Localizando a Lua"}),t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:h==="sun"?"active":"",onClick:()=>O("sun"),children:"☀️ Sol"}),t.jsx("button",{className:h==="moon"?"active":"",onClick:()=>O("moon"),children:"🌙 Lua"})]}),t.jsx("div",{className:"celestial-info",children:h==="sun"?t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"☀️ Nascer do sol"}),t.jsx("strong",{children:P(f==null?void 0:f.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌇 Pôr do sol"}),t.jsx("strong",{children:P(f==null?void 0:f.sunset)})]})]}):t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌕 Nascer da lua"}),t.jsx("strong",{children:P(j==null?void 0:j.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌑 Pôr da lua"}),t.jsx("strong",{children:P(j==null?void 0:j.moonset)})]}),t.jsxs("div",{className:"info-card moon-phase",children:[t.jsxs("span",{children:[b.emoji," Fase"]}),t.jsx("strong",{children:b.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${b.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(b.fraction*100),"% iluminada"]})]})]})}),w&&t.jsxs("div",{className:"camera-container",children:[t.jsx("video",{ref:a,className:`camera-preview${S==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:_,"aria-label":"Alternar câmera",children:"🔄"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:ee,"aria-label":"Capturar foto",children:"⭕"}),t.jsx("button",{className:"camera-btn",onClick:te,"aria-label":"Fechar câmera",children:"✖"})]}),E&&t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:E,alt:"Foto capturada"}),t.jsx("a",{href:E,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"⬇️ Baixar"}),t.jsx("button",{onClick:()=>M(null),className:"close-button",children:"❌ Fechar"})]})]}),t.jsxs("div",{className:"compass-wrapper ",children:[t.jsxs("div",{className:"compass",children:[t.jsx("div",{className:`direction-arrow ${h==="sun"?"active":"secondary"}`,style:{transform:`rotate(${W}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:"☀️"})}),t.jsx("div",{className:`direction-arrow ${h==="moon"?"active":"secondary"}`,style:{transform:`rotate(${J}deg)`},children:t.jsx("div",{className:"celestial-indicator moon-indicator",children:b.emoji})})]}),!w&&t.jsx("button",{className:"main-camera-btn",onClick:()=>C(!0),children:"📸 Ativar Câmera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["🧭 Direção: ",h==="sun"?`${l.toFixed(1)}° (Sol)`:`${N.toFixed(1)}° (Lua)`]}),t.jsx("div",{className:`alignment-feedback ${T?"aligned":""}`,children:T?`⭐ ALINHADO COM ${h==="sun"?"O SOL":"A LUA"}! ⭐`:`Gire o dispositivo para ${h==="sun"?"o Sol":"a Lua"}... ➡️`})]})]}),p&&t.jsx("div",{className:"error-banner",children:p}),t.jsx("canvas",{ref:z,style:{display:"none"}})]})};function P(n){return n?new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}oe.createRoot(document.getElementById("root")).render(t.jsx(o.StrictMode,{children:t.jsx(le,{})}));
//# sourceMappingURL=index-CDAAhd--.js.map
