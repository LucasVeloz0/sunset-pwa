import{r as o,j as t,c as oe}from"./react-vendor-BzzwJzSH.js";import{s as g}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const j of c.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&p(j)}).observe(document,{childList:!0,subtree:!0});function u(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(r){if(r.ep)return;r.ep=!0;const c=u(r);fetch(r.href,c)}})();const re=(i,m)=>{const u=new Date,p=g.getTimes(u,i,m).sunset;return(g.getPosition(p,i,m).azimuth*180/Math.PI+180)%360},ie=i=>(360-i)%360,ae=()=>{const[i,m]=o.useState(null),[u,p]=o.useState(0),[r,c]=o.useState(0),[j,N]=o.useState(null),[S,P]=o.useState(!1),[C,M]=o.useState(null),[w,B]=o.useState("environment"),[G,U]=o.useState(!1),[l,q]=o.useState({sunrise:null,sunset:null,solarNoon:null}),[d,O]=o.useState("sun"),[v,Q]=o.useState(0),[x,K]=o.useState({moonrise:null,moonset:null}),[b,W]=o.useState({fraction:0,phase:0,emoji:"🌑"}),a=o.useRef(null),L=o.useRef(null),h=o.useRef(null),[y,D]=o.useState("default"),[z,T]=o.useState(!1),[J,I]=o.useState(r||0),[V,$]=o.useState(r||0),X=e=>e===0?"🌑":e<.25?"🌒":e<.5?"🌓":e<.75?"🌔":e===1?"🌕":e>.75?"🌖":e>.5?"🌗":"🌘",Y=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final";o.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(e=>{D(e)}):D(Notification.permission))},[]),o.useEffect(()=>{const e=n=>{m({lat:n.coords.latitude,lng:n.coords.longitude})},s=n=>{N(n.message||"Erro ao obter localização")};if(!navigator.geolocation){N("Geolocalização não suportada");return}navigator.geolocation.getCurrentPosition(e,s,{enableHighAccuracy:!0,timeout:5e3})},[]),o.useEffect(()=>{if(i){const e=re(i.lat,i.lng);p(e);const s=new Date,f=(g.getMoonPosition(s,i.lat,i.lng).azimuth*180/Math.PI+180)%360;Q(f)}},[i]),o.useEffect(()=>{const e=s=>{if(s.alpha!==null){let n=s.alpha;typeof s.webkitCompassHeading<"u"&&(n=s.webkitCompassHeading),c(ie(n))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",e,!0):N("Sensor de orientação não suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",e)}},[]),o.useEffect(()=>{if(i){const e=()=>{const n=new Date,f=g.getTimes(n,i.lat,i.lng),se=g.getPosition(n,i.lat,i.lng);q({sunrise:f.sunrise,sunset:f.sunset,solarNoon:f.solarNoon}),U(se.altitude>0);const H=g.getMoonTimes(n,i.lat,i.lng);K({moonrise:H.rise,moonset:H.set});const A=g.getMoonIllumination(n);W({fraction:A.fraction,phase:A.phase,emoji:X(A.fraction),name:Y(A.phase)})};e();const s=setInterval(e,6e4);return()=>{clearInterval(s),h.current&&clearTimeout(h.current)}}},[i]),o.useEffect(()=>{l.sunset&&y==="granted"&&!z&&Z()},[l,y,z]);const Z=o.useCallback(()=>{if(h.current&&clearTimeout(h.current),!l.sunset)return;const e=new Date(l.sunset.getTime()-15*6e4),s=new Date;if(e<=s)return;const n=e-s;h.current=setTimeout(()=>{y==="granted"&&new Notification("O pôr do sol está próximo!",{body:"Faltam 15 minutos para o pôr do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),T(!1)},n),T(!0)},[l,y]);o.useEffect(()=>{let e=null;return S&&(async()=>{try{if(a.current&&a.current.srcObject)return;const n={video:{facingMode:w,width:{ideal:1280},height:{ideal:720}}};a.current&&a.current.srcObject&&(a.current.srcObject.getTracks().forEach(f=>f.stop()),a.current.srcObject=null),e=await navigator.mediaDevices.getUserMedia(n),a.current&&(a.current.srcObject=e,a.current.onloadedmetadata=()=>{a.current.play().catch(f=>{N("Erro ao reproduzir vídeo: "+f.message)})})}catch(n){N("Erro ao acessar câmera: "+n.message),P(!1)}})(),()=>{e&&e.getTracks().forEach(n=>n.stop())}},[S,w]);const _=()=>{B(e=>e==="user"?"environment":"user")},ee=()=>{const e=a.current,s=L.current;if(e&&s&&e.readyState>=2){s.width=e.videoWidth,s.height=e.videoHeight;const n=s.getContext("2d");w==="user"&&(n.translate(s.width,0),n.scale(-1,1)),n.drawImage(e,0,0,s.width,s.height),M(s.toDataURL("image/jpeg",.9))}},te=()=>{var e;(e=a.current)!=null&&e.srcObject&&(a.current.srcObject.getTracks().forEach(s=>s.stop()),a.current.srcObject=null),P(!1),M(null)};o.useEffect(()=>()=>{var e;(e=a.current)!=null&&e.srcObject&&a.current.srcObject.getTracks().forEach(s=>s.stop()),h.current&&clearTimeout(h.current)},[]);function k(e,s){let n=(e-r+360)%360;return n<0&&(n+=360),n}function F(e){let s=(e-r+360)%360;return s>180&&(s-=360),s}o.useEffect(()=>{const e=F(u),s=F(v);I(n=>n+(e-n)*.2),$(n=>n+(s-n)*.2)},[u,v,r]);function ne(e){const s=Math.abs(e-r)%360;return Math.min(s,360-s)}o.useEffect(()=>{const e=k(u),s=k(v);I(n=>n+(e-n)*.2),$(n=>n+(s-n)*.2)},[u,v,r]);const R=ne(d==="sun"?u:v)<15;return t.jsxs("div",{className:`app-container ${G?"day-theme":"night-theme"}`,children:[t.jsx("h1",{children:d==="sun"?"🌅 Localizando o Sol":"🌙 Localizando a Lua"}),t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:d==="sun"?"active":"",onClick:()=>O("sun"),children:"☀️ Sol"}),t.jsx("button",{className:d==="moon"?"active":"",onClick:()=>O("moon"),children:"🌙 Lua"})]}),t.jsx("div",{className:"celestial-info",children:d==="sun"?t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"☀️ Nascer do sol"}),t.jsx("strong",{children:E(l==null?void 0:l.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌇 Pôr do sol"}),t.jsx("strong",{children:E(l==null?void 0:l.sunset)})]})]}):t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌕 Nascer da lua"}),t.jsx("strong",{children:E(x==null?void 0:x.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌑 Pôr da lua"}),t.jsx("strong",{children:E(x==null?void 0:x.moonset)})]}),t.jsxs("div",{className:"info-card moon-phase",children:[t.jsxs("span",{children:[b.emoji," Fase"]}),t.jsx("strong",{children:b.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${b.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(b.fraction*100),"% iluminada"]})]})]})}),S&&t.jsxs("div",{className:"camera-container",children:[t.jsx("video",{ref:a,className:`camera-preview${w==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:_,"aria-label":"Alternar câmera",children:"🔄"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:ee,"aria-label":"Capturar foto",children:"⭕"}),t.jsx("button",{className:"camera-btn",onClick:te,"aria-label":"Fechar câmera",children:"✖"})]}),C&&t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:C,alt:"Foto capturada"}),t.jsx("a",{href:C,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"⬇️ Baixar"}),t.jsx("button",{onClick:()=>M(null),className:"close-button",children:"❌ Fechar"})]})]}),t.jsxs("div",{className:"compass-wrapper ",children:[t.jsxs("div",{className:"compass",children:[t.jsx("div",{className:`direction-arrow ${d==="sun"?"active":"secondary"}`,style:{transform:`rotate(${J}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:"☀️"})}),t.jsx("div",{className:`direction-arrow ${d==="moon"?"active":"secondary"}`,style:{transform:`rotate(${V}deg)`},children:t.jsx("div",{className:"celestial-indicator moon-indicator",children:b.emoji})})]}),!S&&t.jsx("button",{className:"main-camera-btn",onClick:()=>P(!0),children:"📸 Ativar Câmera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["🧭 Direção: ",d==="sun"?`${u.toFixed(1)}° (Sol)`:`${v.toFixed(1)}° (Lua)`]}),t.jsx("div",{className:`alignment-feedback ${R?"aligned":""}`,children:R?`⭐ ALINHADO COM ${d==="sun"?"O SOL":"A LUA"}! ⭐`:`Gire o dispositivo para ${d==="sun"?"o Sol":"a Lua"}... ➡️`})]})]}),j&&t.jsx("div",{className:"error-banner",children:j}),t.jsx("canvas",{ref:L,style:{display:"none"}})]})};function E(i){return i?new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}oe.createRoot(document.getElementById("root")).render(t.jsx(o.StrictMode,{children:t.jsx(ae,{})}));
//# sourceMappingURL=index-dABJxWIE.js.map
