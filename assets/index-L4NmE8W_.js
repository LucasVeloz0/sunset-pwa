import{j as t,r,c as W}from"./react-vendor-BzzwJzSH.js";import{s as w}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const K=({children:e,isDaytime:n})=>t.jsx("div",{className:`app-container ${n?"day-theme":"night-theme"}`,children:e}),J=({videoRef:e,facingMode:n})=>t.jsx("video",{ref:e,className:`camera-preview${n==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),V=({toggleCamera:e,capturePhoto:n,closeCamera:a})=>t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:e,"aria-label":"Alternar câmera",children:"🔄"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:n,"aria-label":"Capturar foto",children:"⭕"}),t.jsx("button",{className:"camera-btn",onClick:a,"aria-label":"Fechar câmera",children:"✖"})]}),X=({photo:e,closePreview:n})=>t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:e,alt:"Foto capturada"}),t.jsx("a",{href:e,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"⬇️ Baixar"}),t.jsx("button",{onClick:n,className:"close-button",children:"❌ Fechar"})]}),Y=({celestialBody:e,setCelestialBody:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:e==="sun"?"active":"",onClick:()=>n("sun"),children:"☀️ Sol"}),t.jsx("button",{className:e==="moon"?"active":"",onClick:()=>n("moon"),children:"🌙 Lua"})]})}),P=e=>e?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--",Z=({sunTimes:e,isDaytime:n})=>t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"☀️ Nascer do sol"}),t.jsx("strong",{children:P(e==null?void 0:e.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌇 Pôr do sol"}),t.jsx("strong",{children:P(e==null?void 0:e.sunset)})]})]}),_=({moonPhase:e})=>t.jsxs("div",{className:"info-card moon-phase moon-phase-card",children:[t.jsxs("span",{children:[e.emoji," Fase"]}),t.jsx("strong",{children:e.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${e.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(e.fraction*100),"% iluminada"]})]}),ee=({moonTimes:e,moonPhase:n})=>t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌕 Nascer da lua"}),t.jsx("strong",{children:P(e==null?void 0:e.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"🌑 Pôr da lua"}),t.jsx("strong",{children:P(e==null?void 0:e.moonset)})]}),t.jsx(_,{moonPhase:n})]}),k=({angle:e,isActive:n,indicator:a,className:o})=>t.jsx("div",{className:`direction-arrow ${n?"active":"secondary"} ${o}`,style:{transform:`rotate(${e}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:a})}),te=({celestialBody:e,smoothedSunAngle:n,smoothedMoonAngle:a,moonPhase:o})=>t.jsx("div",{className:"compass-wrapper",children:t.jsxs("div",{className:"compass",children:[t.jsx(k,{angle:n,isActive:e==="sun",indicator:"☀️",className:"sun-indicator"}),t.jsx(k,{angle:a,isActive:e==="moon",indicator:o.emoji,className:"moon-indicator"})]})}),ne=({messages:e})=>t.jsx("div",{className:"error-container",children:e.map((n,a)=>t.jsx("div",{className:"error-banner",children:n},a))});function re(){const[e,n]=r.useState(null),[a,o]=r.useState(null);return r.useEffect(()=>{const s=f=>{n({lat:f.coords.latitude,lng:f.coords.longitude})},i=f=>{o(f.message||"Erro ao obter localização")};if(!navigator.geolocation){o("Geolocalização não suportada");return}navigator.geolocation.getCurrentPosition(s,i,{enableHighAccuracy:!0,timeout:5e3});const d=navigator.geolocation.watchPosition(s,i,{enableHighAccuracy:!0,timeout:1e4});return()=>{navigator.geolocation.clearWatch(d)}},[]),{position:e,error:a}}const se=e=>e===null?0:(360-e)%360,F=e=>(e%360+360)%360,R=(e,n,a)=>{if(e===void 0)return n;let o=(n-e+180)%360-180;return o=o<-180?o+360:o,e+o*a},oe=(e,n)=>{const a=Math.abs(e-n)%360;return Math.min(a,360-a)};function ae(){const[e,n]=r.useState(null),[a,o]=r.useState(null);return r.useEffect(()=>{const s=i=>{if(i.alpha!==null){let d=i.alpha;typeof i.webkitCompassHeading<"u"&&(d=i.webkitCompassHeading),n(se(d))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",s,!0):o("Sensor de orientação não suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",s)}},[]),{deviceHeading:e,error:a}}function ie(){const[e,n]=r.useState(!1),[a,o]=r.useState(null),[s,i]=r.useState("environment"),[d,f]=r.useState(null),l=r.useRef(null),x=r.useRef(null),m=r.useCallback(async()=>{try{if(l.current&&l.current.srcObject)return;const c={video:{facingMode:s,width:{ideal:1280},height:{ideal:720}}},u=await navigator.mediaDevices.getUserMedia(c);l.current&&(l.current.srcObject=u,l.current.onloadedmetadata=()=>{l.current.play().catch(h=>{f("Erro ao reproduzir vídeo: "+h.message)})})}catch(c){f("Erro ao acessar câmera: "+c.message),n(!1)}},[s]);r.useEffect(()=>{var c;e?m():(c=l.current)!=null&&c.srcObject&&(l.current.srcObject.getTracks().forEach(u=>u.stop()),l.current.srcObject=null)},[e,m]),r.useEffect(()=>{e&&m()},[s,e,m]);const g=()=>{i(c=>c==="user"?"environment":"user")},j=r.useCallback(()=>{const c=l.current,u=x.current;if(c&&u&&c.readyState>=2){u.width=c.videoWidth,u.height=c.videoHeight;const h=u.getContext("2d");s==="user"&&(h.translate(u.width,0),h.scale(-1,1)),h.drawImage(c,0,0,u.width,u.height),o(u.toDataURL("image/jpeg",.9))}},[s]),v=r.useCallback(()=>{n(!1),o(null)},[]);return{cameraActive:e,setCameraActive:n,photo:a,setPhoto:o,facingMode:s,toggleCamera:g,capturePhoto:j,closeCamera:v,videoRef:l,canvasRef:x,cameraError:d}}const ce=(e,n)=>{const a=new Date,o=w.getPosition(a,e,n);return H((o.azimuth*180/Math.PI+180)%360)},le=(e,n)=>{const a=new Date,o=w.getMoonPosition(a,e,n);return H((o.azimuth*180/Math.PI+180)%360)},ue=e=>e===0?"🌑":e<.25?"🌒":e<.5?"🌓":e<.75?"🌔":e===1?"🌕":e>.75?"🌖":e>.5?"🌗":"🌘",de=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final",H=e=>(e%360+360)%360;function me(e){const[n,a]=r.useState(0),[o,s]=r.useState(0),[i,d]=r.useState({sunrise:null,sunset:null}),[f,l]=r.useState({moonrise:null,moonset:null}),[x,m]=r.useState({fraction:0,phase:0,emoji:"🌑",name:"Lua Nova"}),[g,j]=r.useState(!1);return r.useEffect(()=>{if(!e)return;const v=()=>{const u=new Date,h=w.getTimes(u,e.lat,e.lng),y=w.getPosition(u,e.lat,e.lng);d({sunrise:h.sunrise,sunset:h.sunset}),j(y.altitude>0);const S=w.getMoonTimes(u,e.lat,e.lng);l({moonrise:S.rise,moonset:S.set});const N=w.getMoonIllumination(u);m({fraction:N.fraction,phase:N.phase,emoji:ue(N.fraction),name:de(N.phase)})};v();const c=setInterval(v,6e4);return()=>clearInterval(c)},[e]),r.useEffect(()=>{if(!e)return;const v=()=>{a(ce(e.lat,e.lng)),s(le(e.lat,e.lng))};v();const c=setInterval(v,6e4);return()=>clearInterval(c)},[e]),{sunAzimuth:n,moonAzimuth:o,sunTimes:i,moonTimes:f,moonPhase:x,isDaytime:g}}const fe=()=>{const[e,n]=r.useState("sun"),[a,o]=r.useState(0),[s,i]=r.useState(0),{position:d,error:f}=re(),{deviceHeading:l,error:x}=ae(),{sunAzimuth:m,moonAzimuth:g,sunTimes:j,moonTimes:v,moonPhase:c,isDaytime:u}=me(d),{cameraActive:h,setCameraActive:y,photo:S,setPhoto:N,facingMode:G,toggleCamera:O,capturePhoto:U,closeCamera:B,videoRef:M,canvasRef:q,error:Q}=ie(),A=r.useRef(null),[E,z]=r.useState("default"),[D,L]=r.useState(!1);r.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(p=>{z(p)}):z(Notification.permission))},[]),r.useEffect(()=>{j.sunset&&E==="granted"&&!D&&T()},[j,E,D]);const T=r.useCallback(()=>{if(A.current&&clearTimeout(A.current),!j.sunset)return;const p=new Date(j.sunset.getTime()-15*6e4),b=new Date;if(p<=b)return;const C=p-b;A.current=setTimeout(()=>{E==="granted"&&new Notification("O pôr do sol está próximo!",{body:"Faltam 15 minutos para o pôr do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),L(!1)},C),L(!0)},[j,E]);r.useEffect(()=>()=>{var p;(p=M.current)!=null&&p.srcObject&&M.current.srcObject.getTracks().forEach(b=>b.stop()),A.current&&clearTimeout(A.current)},[]),r.useEffect(()=>{if(m===null||g===null||l===null)return;const p=F(m-l),b=F(g-l);o(C=>R(C,p,.2)),i(C=>R(C,b,.2))},[m,g,l]);const I=oe(e==="sun"?m:g,l)<15,$=[f,x,Q].filter(Boolean);return t.jsxs(K,{isDaytime:u,children:[t.jsx("h1",{children:e==="sun"?"🌅 Localizando o Sol":"🌙 Localizando a Lua"}),t.jsx(Y,{celestialBody:e,setCelestialBody:n}),e==="sun"?t.jsx(Z,{sunTimes:j}):t.jsx(ee,{moonTimes:v,moonPhase:c}),h&&t.jsxs("div",{className:"camera-container",children:[t.jsx(J,{toggleCamera:O,videoRef:M,facingMode:G}),t.jsx(V,{toggleCamera:O,capturePhoto:U,closeCamera:B}),S&&t.jsx(X,{photo:S,closePreview:()=>N(null)})]}),t.jsx(te,{celestialBody:e,smoothedSunAngle:a,smoothedMoonAngle:s,moonPhase:c}),!h&&t.jsx("button",{className:"main-camera-btn",onClick:()=>y(!0),children:"📸 Ativar Câmera"}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["🧭 Direção: ",e==="sun"?`${m?m.toFixed(1):"--"}° (Sol)`:`${g?g.toFixed(1):"--"}° (Lua)`]}),t.jsx("div",{className:`alignment-feedback ${I?"aligned":""}`,children:I?`⭐ ALINHADO COM ${e==="sun"?"O SOL":"A LUA"}! ⭐`:`Gire o dispositivo para ${e==="sun"?"o Sol":"a Lua"}... ➡️`})]}),$.length>0&&t.jsx(ne,{messages:$}),t.jsx("canvas",{ref:q,style:{display:"none"}})]})};W.createRoot(document.getElementById("root")).render(t.jsx(r.StrictMode,{children:t.jsx(fe,{})}));
//# sourceMappingURL=index-L4NmE8W_.js.map
