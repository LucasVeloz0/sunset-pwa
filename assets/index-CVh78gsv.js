import{r as o,j as t,c as te}from"./react-vendor-BzzwJzSH.js";import{s as g}from"./suncalc-DPRD1gft.js";import"./vendor-SPyfQU6S.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))p(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const j of c.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&p(j)}).observe(document,{childList:!0,subtree:!0});function m(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(i){if(i.ep)return;i.ep=!0;const c=m(i);fetch(i.href,c)}})();const ne=(r,d)=>{const m=new Date,p=g.getTimes(m,r,d).sunset;return(g.getPosition(p,r,d).azimuth*180/Math.PI+180)%360},se=r=>(360-r)%360,oe=()=>{const[r,d]=o.useState(null),[m,p]=o.useState(0),[i,c]=o.useState(0),[j,x]=o.useState(null),[S,A]=o.useState(!1),[C,O]=o.useState(null),[w,F]=o.useState("environment"),[R,H]=o.useState(!1),[l,B]=o.useState({sunrise:null,sunset:null,solarNoon:null}),[u,D]=o.useState("sun"),[N,G]=o.useState(0),[v,U]=o.useState({moonrise:null,moonset:null}),[b,q]=o.useState({fraction:0,phase:0,emoji:"ðŸŒ‘"}),a=o.useRef(null),z=o.useRef(null),h=o.useRef(null),[y,T]=o.useState("default"),[I,$]=o.useState(!1),[re,Q]=o.useState(0),[ie,K]=o.useState(0),W=e=>e===0?"ðŸŒ‘":e<.25?"ðŸŒ’":e<.5?"ðŸŒ“":e<.75?"ðŸŒ”":e===1?"ðŸŒ•":e>.75?"ðŸŒ–":e>.5?"ðŸŒ—":"ðŸŒ˜",J=e=>e===0||e===1?"Lua Nova":e<.25?"Crescente Inicial":e===.25?"Quarto Crescente":e<.5?"Gibosa Crescente":e===.5?"Lua Cheia":e<.75?"Gibosa Minguante":e===.75?"Quarto Minguante":"Minguante Final";o.useEffect(()=>{"Notification"in window&&(Notification.permission!=="granted"&&Notification.permission!=="denied"?Notification.requestPermission().then(e=>{T(e)}):T(Notification.permission))},[]),o.useEffect(()=>{const e=s=>{d({lat:s.coords.latitude,lng:s.coords.longitude})},n=s=>{x(s.message||"Erro ao obter localizaÃ§Ã£o")};if(!navigator.geolocation){x("GeolocalizaÃ§Ã£o nÃ£o suportada");return}navigator.geolocation.getCurrentPosition(e,n,{enableHighAccuracy:!0,timeout:5e3})},[]),o.useEffect(()=>{if(r){const e=ne(r.lat,r.lng);p(e);const n=new Date,f=(g.getMoonPosition(n,r.lat,r.lng).azimuth*180/Math.PI+180)%360;G(f)}},[r]),o.useEffect(()=>{const e=n=>{if(n.alpha!==null){let s=n.alpha;typeof n.webkitCompassHeading<"u"&&(s=n.webkitCompassHeading),c(se(s))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",e,!0):x("Sensor de orientaÃ§Ã£o nÃ£o suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",e)}},[]),o.useEffect(()=>{if(r){const e=()=>{const s=new Date,f=g.getTimes(s,r.lat,r.lng),ee=g.getPosition(s,r.lat,r.lng);B({sunrise:f.sunrise,sunset:f.sunset,solarNoon:f.solarNoon}),H(ee.altitude>0);const k=g.getMoonTimes(s,r.lat,r.lng);U({moonrise:k.rise,moonset:k.set});const E=g.getMoonIllumination(s);q({fraction:E.fraction,phase:E.phase,emoji:W(E.fraction),name:J(E.phase)})};e();const n=setInterval(e,6e4);return()=>{clearInterval(n),h.current&&clearTimeout(h.current)}}},[r]),o.useEffect(()=>{l.sunset&&y==="granted"&&!I&&V()},[l,y,I]);const V=o.useCallback(()=>{if(h.current&&clearTimeout(h.current),!l.sunset)return;const e=new Date(l.sunset.getTime()-15*6e4),n=new Date;if(e<=n)return;const s=e-n;h.current=setTimeout(()=>{y==="granted"&&new Notification("O pÃ´r do sol estÃ¡ prÃ³ximo!",{body:"Faltam 15 minutos para o pÃ´r do sol. Prepare-se para capturar uma foto perfeita!",icon:"/sunset-icon.png"}),$(!1)},s),$(!0)},[l,y]);o.useEffect(()=>{let e=null;return S&&(async()=>{try{if(a.current&&a.current.srcObject)return;const s={video:{facingMode:w,width:{ideal:1280},height:{ideal:720}}};a.current&&a.current.srcObject&&(a.current.srcObject.getTracks().forEach(f=>f.stop()),a.current.srcObject=null),e=await navigator.mediaDevices.getUserMedia(s),a.current&&(a.current.srcObject=e,a.current.onloadedmetadata=()=>{a.current.play().catch(f=>{x("Erro ao reproduzir vÃ­deo: "+f.message)})})}catch(s){x("Erro ao acessar cÃ¢mera: "+s.message),A(!1)}})(),()=>{e&&e.getTracks().forEach(s=>s.stop())}},[S,w]);const X=()=>{F(e=>e==="user"?"environment":"user")},Y=()=>{const e=a.current,n=z.current;if(e&&n&&e.readyState>=2){n.width=e.videoWidth,n.height=e.videoHeight;const s=n.getContext("2d");w==="user"&&(s.translate(n.width,0),s.scale(-1,1)),s.drawImage(e,0,0,n.width,n.height),O(n.toDataURL("image/jpeg",.9))}},Z=()=>{var e;(e=a.current)!=null&&e.srcObject&&(a.current.srcObject.getTracks().forEach(n=>n.stop()),a.current.srcObject=null),A(!1),O(null)};o.useEffect(()=>()=>{var e;(e=a.current)!=null&&e.srcObject&&a.current.srcObject.getTracks().forEach(n=>n.stop()),h.current&&clearTimeout(h.current)},[]);function M(e){let n=(e-i+360)%360;return n<0&&(n+=360),n}function _(e){const n=Math.abs(M(e)-180)%360;return n>180?360-n:n}o.useEffect(()=>{const e=M(m),n=M(N);Q(s=>s+(e-s)*.2),K(s=>s+(n-s)*.2)},[m,N,i]);const L=_(u==="sun"?m:N)<15;return t.jsxs("div",{className:`app-container ${R?"day-theme":"night-theme"}`,children:[t.jsx("h1",{children:u==="sun"?"ðŸŒ… Localizando o Sol":"ðŸŒ™ Localizando a Lua"}),t.jsxs("div",{className:"celestial-toggle",children:[t.jsx("button",{className:u==="sun"?"active":"",onClick:()=>D("sun"),children:"â˜€ï¸ Sol"}),t.jsx("button",{className:u==="moon"?"active":"",onClick:()=>D("moon"),children:"ðŸŒ™ Lua"})]}),t.jsx("div",{className:"celestial-info",children:u==="sun"?t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"â˜€ï¸ Nascer do sol"}),t.jsx("strong",{children:P(l==null?void 0:l.sunrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"ðŸŒ‡ PÃ´r do sol"}),t.jsx("strong",{children:P(l==null?void 0:l.sunset)})]})]}):t.jsxs("div",{className:"info-cards",children:[t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"ðŸŒ• Nascer da lua"}),t.jsx("strong",{children:P(v==null?void 0:v.moonrise)})]}),t.jsxs("div",{className:"info-card",children:[t.jsx("span",{children:"ðŸŒ‘ PÃ´r da lua"}),t.jsx("strong",{children:P(v==null?void 0:v.moonset)})]}),t.jsxs("div",{className:"info-card moon-phase",children:[t.jsxs("span",{children:[b.emoji," Fase"]}),t.jsx("strong",{children:b.name}),t.jsx("div",{className:"moon-phase-bar",children:t.jsx("div",{className:"moon-phase-fill",style:{width:`${b.fraction*100}%`}})}),t.jsxs("span",{className:"moon-percentage",children:[Math.round(b.fraction*100),"% iluminada"]})]})]})}),S&&t.jsxs("div",{className:"camera-container",children:[t.jsx("video",{ref:a,className:`camera-preview${w==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),t.jsxs("div",{className:"camera-controls",children:[t.jsx("button",{className:"camera-btn",onClick:X,"aria-label":"Alternar cÃ¢mera",children:"ðŸ”„"}),t.jsx("button",{className:"camera-btn capture-btn",onClick:Y,"aria-label":"Capturar foto",children:"â­•"}),t.jsx("button",{className:"camera-btn",onClick:Z,"aria-label":"Fechar cÃ¢mera",children:"âœ–"})]}),C&&t.jsxs("div",{className:"photo-preview",children:[t.jsx("img",{src:C,alt:"Foto capturada"}),t.jsx("a",{href:C,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"â¬‡ï¸ Baixar"}),t.jsx("button",{onClick:()=>O(null),className:"close-button",children:"âŒ Fechar"})]})]}),t.jsxs("div",{className:`alignment-feedback ${L?"aligned":""} compass-wrapper`,children:[t.jsxs("div",{className:"compass",children:[t.jsx("div",{className:`direction-arrow ${u==="sun"?"active":"secondary"}`,style:{transform:`rotate(${m-i}deg)`},children:t.jsx("div",{className:"celestial-indicator",children:"â˜€ï¸"})}),t.jsx("div",{className:`direction-arrow ${u==="moon"?"active":"secondary"}`,style:{transform:`rotate(${N-i}deg)`},children:t.jsx("div",{className:"celestial-indicator moon-indicator",children:b.emoji})}),t.jsxs("div",{className:"info-panel",children:[t.jsxs("p",{children:["ðŸ§­ DireÃ§Ã£o: ",u==="sun"?m.toFixed(1)+"Â° (Sol)":N.toFixed(1)+"Â° (Lua)"]}),t.jsx("div",{className:`alignment-feedback ${L?"aligned":""}`,children:L?`â­ ALINHADO COM ${u==="sun"?"O SOL":"A LUA"}! â­`:`Gire o dispositivo para ${u==="sun"?"o Sol":"a Lua"}... âž¡ï¸`})]})]}),!S&&t.jsx("button",{className:"main-camera-btn",onClick:()=>A(!0),children:"ðŸ“¸ Ativar CÃ¢mera"})]}),j&&t.jsx("div",{className:"error-banner",children:j}),t.jsx("canvas",{ref:z,style:{display:"none"}})]})};function P(r){return r?new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}te.createRoot(document.getElementById("root")).render(t.jsx(o.StrictMode,{children:t.jsx(oe,{})}));
//# sourceMappingURL=index-CVh78gsv.js.map
