import{j as e,C as P,O as D,a as o,u as L,S as A,c as k}from"./react-vendor-7kmZws0J.js";import{s as j}from"./suncalc-DPRD1gft.js";import"./vendor-BVhIu4by.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))d(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function l(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(r){if(r.ep)return;r.ep=!0;const s=l(r);fetch(r.href,s)}})();const z=(n,u)=>{const l=new Date,d=j.getTimes(l,n,u).sunset;return(j.getPosition(d,n,u).azimuth*180/Math.PI+180)%360},M=n=>(360-n)%360,R=({latitude:n,longitude:u})=>{const l=o.useRef(),d=o.useRef();return o.useEffect(()=>{const r=s=>{if(l.current){const m=s.beta*.01,f=s.gamma*.01;l.current.position.y+=m,l.current.position.x+=f}};return window.addEventListener("deviceorientation",r),()=>window.removeEventListener("deviceorientation",r)},[]),L(()=>{const r=new Date,s=j.getPosition(r,n,u),m=100,f=m*Math.cos(s.altitude)*Math.sin(s.azimuth),h=m*Math.sin(s.altitude),p=m*Math.cos(s.altitude)*Math.cos(s.azimuth);if(l.current&&l.current.position.set(f,h,p),d.current){const g=s.altitude>0;d.current.material.uniforms.sunPosition.value.set(f,h,p),d.current.material.uniforms.turbidity.value=g?2:10,d.current.material.uniforms.rayleigh.value=g?1:3}}),e.jsxs(e.Fragment,{children:[e.jsx(A,{ref:d,distance:1e3,sunPosition:[0,0,0],turbidity:2,rayleigh:1,mieCoefficient:.005,mieDirectionalG:.8}),e.jsxs("mesh",{ref:l,children:[e.jsx("sphereGeometry",{args:[5,32,32]}),e.jsx("meshBasicMaterial",{color:"#FFD700"}),e.jsx("pointLight",{intensity:1.5,color:"#FFD700"})]})]})},F=({latitude:n,longitude:u})=>e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:-1},children:e.jsxs(P,{camera:{position:[0,0,50],fov:75},children:[e.jsx("ambientLight",{intensity:.1}),e.jsx(R,{latitude:n,longitude:u}),e.jsx(D,{enableZoom:!1,enablePan:!1,enableRotate:!1})]})}),H=()=>{const[n,u]=o.useState(null),[l,d]=o.useState(0),[r,s]=o.useState(0),[m,f]=o.useState(null),[h,p]=o.useState(!1),[g,x]=o.useState(null),[v,N]=o.useState("environment"),i=o.useRef(null),y=o.useRef(null);o.useEffect(()=>{const t=c=>{u({lat:c.coords.latitude,lng:c.coords.longitude})},a=c=>{f(c.message||"Erro ao obter localiza√ß√£o")};if(!navigator.geolocation){f("Geolocaliza√ß√£o n√£o suportada");return}navigator.geolocation.getCurrentPosition(t,a,{enableHighAccuracy:!0,timeout:5e3})},[]),o.useEffect(()=>{if(n){const t=z(n.lat,n.lng);d(t)}},[n]),o.useEffect(()=>{const t=a=>{if(a.alpha!==null){let c=a.alpha;typeof a.webkitCompassHeading<"u"&&(c=a.webkitCompassHeading),s(M(c))}};return window.DeviceOrientationEvent?window.addEventListener("deviceorientation",t,!0):f("Sensor de orienta√ß√£o n√£o suportado neste dispositivo"),()=>{window.removeEventListener("deviceorientation",t)}},[]),o.useEffect(()=>{let t=null;return h&&(async()=>{try{if(i.current&&i.current.srcObject)return;const c={video:{facingMode:v,width:{ideal:1280},height:{ideal:720}}};i.current&&i.current.srcObject&&(i.current.srcObject.getTracks().forEach(b=>b.stop()),i.current.srcObject=null),t=await navigator.mediaDevices.getUserMedia(c),i.current&&(i.current.srcObject=t,i.current.onloadedmetadata=()=>{i.current.play().catch(b=>{f("Erro ao reproduzir v√≠deo: "+b.message)})})}catch(c){f("Erro ao acessar c√¢mera: "+c.message),p(!1)}})(),()=>{t&&t.getTracks().forEach(c=>c.stop())}},[h,v]);const O=()=>{N(t=>t==="user"?"environment":"user")},S=()=>{const t=i.current,a=y.current;if(t&&a&&t.readyState>=2){a.width=t.videoWidth,a.height=t.videoHeight;const c=a.getContext("2d");v==="user"&&(c.translate(a.width,0),c.scale(-1,1)),c.drawImage(t,0,0,a.width,a.height),x(a.toDataURL("image/jpeg",.9))}},C=()=>{var t;(t=i.current)!=null&&t.srcObject&&(i.current.srcObject.getTracks().forEach(a=>a.stop()),i.current.srcObject=null),p(!1),x(null)};o.useEffect(()=>()=>{var t;(t=i.current)!=null&&t.srcObject&&i.current.srcObject.getTracks().forEach(a=>a.stop())},[]);const w=()=>{let t=(l-r+360)%360;return t>180&&(t-=360),t},E=Math.abs(w())<15;return e.jsxs("div",{className:"app-container",children:[n&&e.jsx(F,{latitude:n.lat,longitude:n.lng}),e.jsx("h1",{children:"üåÖ Localizando o P√¥r do Sol"}),h&&e.jsxs("div",{className:"camera-container",children:[e.jsx("video",{ref:i,className:`camera-preview${v==="user"?" mirrored":""}`,playsInline:!0,muted:!0}),e.jsxs("div",{className:"camera-controls",children:[e.jsx("button",{className:"camera-btn",onClick:O,"aria-label":"Alternar c√¢mera",children:"üîÑ"}),e.jsx("button",{className:"camera-btn capture-btn",onClick:S,"aria-label":"Capturar foto",children:"‚≠ï"}),e.jsx("button",{className:"camera-btn",onClick:C,"aria-label":"Fechar c√¢mera",children:"‚úñ"})]}),g&&e.jsxs("div",{className:"photo-preview",children:[e.jsx("img",{src:g,alt:"Foto capturada"}),e.jsx("a",{href:g,download:`por-do-sol-${Date.now()}.jpg`,className:"download-button",children:"‚¨áÔ∏è Baixar"}),e.jsx("button",{onClick:()=>x(null),className:"close-button",children:"‚ùå Fechar"})]})]}),!h&&e.jsx("button",{className:"main-camera-btn",onClick:()=>p(!0),children:"üì∏ Ativar C√¢mera"}),e.jsxs("div",{className:"compass-wrapper",children:[e.jsxs("div",{className:"compass",children:[e.jsx("div",{className:"direction-arrow",style:{transform:`rotate(${w()}deg)`},children:e.jsx("div",{className:"sun-indicator",children:"‚òÄÔ∏è"})}),e.jsx("div",{className:"alignment-marker"})]}),e.jsxs("div",{className:"info-panel",children:[e.jsxs("p",{children:["‚è± Hor√°rio do p√¥r do sol: ",n&&new Date(j.getTimes(new Date,n.lat,n.lng).sunset).toLocaleTimeString()]}),e.jsxs("p",{children:["üß≠ Dire√ß√£o: ",l.toFixed(1),"¬∞"]}),e.jsx("div",{className:`alignment-feedback ${E?"aligned":""}`,children:E?"‚≠ê ALINHADO! ‚≠ê":"Gire o dispositivo... ‚û°Ô∏è"})]})]}),m&&e.jsx("div",{className:"error-banner",children:m}),e.jsx("canvas",{ref:y,style:{display:"none"}})]})};k.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(H,{})}));
//# sourceMappingURL=index-C1fycayY.js.map
